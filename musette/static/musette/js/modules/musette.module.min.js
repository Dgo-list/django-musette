!function(){"use strict";try{var t=JSON.parse($("#musette_module_js").html()),o=t.user_auth}catch(t){var o=null}var e=Vue.extend({methods:{connectionWs:function(t,e){var n;if(n="https:"===window.location.protocol?"wss:":"ws:",t)var i=n+"//"+window.location.hostname+":8888/ws/?user="+o;else var i=n+"//"+window.location.hostname+":8888/ws/?topic="+e;return new WebSocket(i)},loading:function(){$("#loading-img").removeAttr("class")}}}),n={data:{search_text:""},methods:{search:function(t,o){var e=this.search_text;window.location="/search_topic/"+t+"/"+o+"/?q="+e}}},i={data:function(){return window.__FORM__||{title:"",touchTitle:!1,description:"",touchDescription:!1}},mounted:function(){var t=this;setTimeout(function(){try{var o=tinyMCE.get("id_description");void 0!==o&&o.on("keyup",function(e){var n=o.getContent();t.description=n||""})}catch(t){}},1e3)},watch:{title:function(){this.touchTitle=!0},description:function(){this.touchDescription=!0}}},r={data:function(){return window.__FORM__||{description:"",descrip_comments:[]}},methods:{like_comment:function(t){var o=$("[name='csrfmiddlewaretoken']").first().val(),e={idcomment:t,is_like:1,csrfmiddlewaretoken:o};$.ajax({url:"/like_unlike_comment/",type:"POST",data:e,success:function(o,e,n){if(200==n.status){var i=parseInt($("#like_comment_button_"+t).find("span").text())+1;$("#like_comment_button_"+t).find("span").text(i),$("#unlike_comment_button_"+t).find("span").text(i),$("#like_comment_button_"+t).hide(),$("#unlike_comment_button_"+t).show()}},error:function(t,o,e){toastr.error("Error")}})},unlike_comment:function(t){var o=$("[name='csrfmiddlewaretoken']").first().val(),e={idcomment:t,is_like:0,csrfmiddlewaretoken:o};$.ajax({url:"/like_unlike_comment/",type:"POST",data:e,success:function(o,e,n){if(200==n.status){var i=parseInt($("#unlike_comment_button_"+t).find("span").text())-1;$("#unlike_comment_button_"+t).find("span").text(i),$("#like_comment_button_"+t).find("span").text(i),$("#unlike_comment_button_"+t).hide(),$("#like_comment_button_"+t).show()}},error:function(t,o,e){toastr.error("Error")}})}}},s={data:{topic_id_ws:0,comments_socket:[]},mounted:function(){var t=this;setTimeout(function(){try{var o=tinyMCE.get("id_description");void 0!==o&&o.on("keyup",function(e){var n=o.getContent();t.description=n||""})}catch(t){}},1e3);var o=parseInt($("#topic_musette").val());if(!isNaN(o)){this.connectionWs(!1,o).onmessage=function(o){if(0==$("a.endless_more").length){var e=o.data,n=JSON.parse(e);t.comments_socket.push(n);var i=parseInt($("#total_comments_topic").text())+1;$("#total_comments_topic").text(i)}}}},methods:{open_topic:function(t,o){var e=$("[name='csrfmiddlewaretoken']").first().val(),n={idtopic:t,userid:o,is_close:0,csrfmiddlewaretoken:e};$.ajax({url:"/open_close_topic/",type:"POST",data:n,success:function(t){$("#close_topic").hide("slow"),$("#close_topic_button").show("slow"),$("#open_topic_button").hide("slow")},error:function(t,o,e){toastr.error("Error")}})},close_topic:function(t,o){var e=$("[name='csrfmiddlewaretoken']").first().val(),n={idtopic:t,userid:o,is_close:1,csrfmiddlewaretoken:e};$.ajax({url:"/open_close_topic/",type:"POST",data:n,success:function(t){$("#close_topic").show("slow"),$("#open_topic_button").show("slow"),$("#close_topic_button").hide("slow")},error:function(t,o,e){toastr.error("Error")}})},delete_topic:function(t,o,e){var n=$("[name='csrfmiddlewaretoken']").first().val(),i={idtopic:e,forum:o,csrfmiddlewaretoken:n};$.ajax({url:"/delete_topic/",type:"DELETE",data:i,success:function(e,n,i){200==parseInt(i.status)?window.location.href="/forum/"+t+"/"+o:toastr.error("Error")},error:function(t,o,e){toastr.error("Error")}})},like_topic:function(t){var o=$("[name='csrfmiddlewaretoken']").first().val(),e={idtopic:t,is_like:1,csrfmiddlewaretoken:o};$.ajax({url:"/like_unlike_topic/",type:"POST",data:e,success:function(t,o,e){if(200==e.status){var n=parseInt($("#like_topic_button").find("span").text())+1;$("#like_topic_button").find("span").text(n),$("#unlike_topic_button").find("span").text(n),$("#like_topic_button").hide(),$("#unlike_topic_button").show()}},error:function(t,o,e){toastr.error("Error")}})},unlike_topic:function(t){var o=$("[name='csrfmiddlewaretoken']").first().val(),e={idtopic:t,is_like:0,csrfmiddlewaretoken:o};$.ajax({url:"/like_unlike_topic/",type:"POST",data:e,success:function(t,o,e){if(200==e.status){var n=parseInt($("#unlike_topic_button").find("span").text())-1;$("#unlike_topic_button").find("span").text(n),$("#like_topic_button").find("span").text(n),$("#unlike_topic_button").hide(),$("#like_topic_button").show()}},error:function(t,o,e){toastr.error("Error")}})}}};new e({el:"#app-musette",mixins:[{data:{user:"",tot_notifications:0,notifications_socket:[]},mounted:function(){var t=this;this.connectionWs(!0).onmessage=function(o){var e=o.data,n=JSON.parse(e);t.notifications_socket.unshift(n),t.tot_notifications++,$("#badge_notifications").text("0").removeClass("hide").html(t.tot_notifications);try{$("#no_notifications").addClass("hide")}catch(t){}}},methods:{view_all:function(){$.ajax({url:"/forum_set_notifications/",type:"GET",success:function(t){$("#badge_notifications").text("0").addClass("hide"),this.tot_notifications=0},error:function(t,o,e){toastr.error("Error")}})}}},i,s,n,r]})}();